@{ 
    ViewData["Title"] = "Listado de catálogos.";
}
<div ng-app="SedeshuApp" ng-controller="indexController">
    <div class="row justify-content-center">
        <div class="col-sm-10">
            <div class="card border-cards">
                <div class="card-header bg-cards text-white">
                    <h5 class="float-left">Listado de catálogos de respuestas</h5>
                    <a class="btn btn-sm btn-success float-right" asp-controller="CatalogoRespuestas" asp-action="Index">
                        <i class="fa fa-plus"></i> Crear catálogo de respuestas
                    </a>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-sm-4">
                            <label>Catálogo</label>
                            <input class="form-control" ng-model="catalogo" ng-keypress="$event.keyCode == 13 ? obtenerCatalogos() : null" />
                        </div>
                        <div class="col-sm-2">
                            <label class="col-sm-12">&nbsp;</label>
                            <button class="btn btn-sm btn-info" ng-click="obtenerCatalogos()">
                                <i class="fa fa-search"></i> Buscar
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-sm table-bordered mt-3" ng-if="!cargando">
                            <thead>
                                <tr>
                                    <th>Catálogo</th>
                                    <th>Respuestas</th>
                                    <th class="no-stretch"></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="catalogo in catalogos">
                                    <td>{{ catalogo.Nombre }}</td>
                                    <td>{{ catalogo.Respuestas }}</td>
                                    <td>
                                        <a class="btn btn-sm btn-primary" href="@Url.Action(controller: "CatalogoRespuestas", action: "Index")/{{ catalogo.Id }}">
                                            <i class="fa fa-edit"></i>
                                        </a>
                                    </td>
                                </tr>
                                <tr ng-if="catalogos.length == 0">
                                    <td colspan="3">No hay datos para mostrar.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="col-sm-12" style="text-align: center;" ng-if="cargando">
                        <i class="fa fa-spinner fa-spin"></i>
                    </div>
                    <div class="float-right" ng-if="!cargando">
                        <ul uib-pagination total-items="totalcount" ng-change="pagechanged()"
                            items-per-page="pageSize" direction-links="false" ng-model="pageIndex" role="menu"
                            max-size="maxsize" class="pagination-sm" boundary-links="true" rotate="true"
                            num-pages="numPages" style="margin-bottom: 0px !important"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        (function () {
            var app = angular.module('SedeshuApp', ['ui.bootstrap']);

            app.controller('indexController',
                function ($scope, $http, $uibModal) {
                    $scope.catalogo = "";
                    $scope.catalogos = [];
                    $scope.cargando = false;
                    //Paginacion
                    $scope.maxsize = 5;
                    $scope.totalcount = 0;
                    $scope.pageIndex = 1;
                    $scope.pageSize = 10;
                    $scope.numPages = 0;

                    $scope.obtenerCatalogos = function () {
                        $scope.cargando = true;
                        $http.post('/CatalogoRespuestas/ObtenerCatalogos', {
                                Nombre: $scope.catalogo,
                                PageIndex: $scope.pageIndex,
                                PageSize: $scope.pageSize
                            })
                            .then(function (response) {
                                $scope.totalcount = response.data.Total;
                                $scope.catalogos = response.data.Catalogos;
                                $scope.cargando = false;
                            });
                    };

                    $scope.pagechanged = function () {
                        $scope.obtenerCatalogos();
                    };

                    $scope.obtenerCatalogos();
                }
            );
        })();
    </script>
}