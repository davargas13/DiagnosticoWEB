@using Newtonsoft.Json;
<div ng-app="SedeshuApp" ng-controller="createEditController" ng-init="init(@JsonConvert.SerializeObject(Model))">
    <div class="row justify-content-center">
        <div class="col-sm-8">
            <div class="card border-cards">
                <div class="card-header bg-cards text-white">
                    @if (!string.IsNullOrEmpty(Model.Id)) {
                        <h5 class="float-left">Editar catálogo de respuestas</h5>
                    } else {
                        <h5 class="float-left">Crear catálogo de respuestas</h5>
                    }
                    <a class="btn btn-sm btn-light float-right" asp-controller="CatalogoRespuestas" asp-action="Index">
                        <i class="fa fa-backward"></i> Regresar
                    </a>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-sm-6">
                            <label>Nombre del catálogo <small>{{ catalogo.Nombre.length }} / 255</small></label>
                            <input class="form-control" ng-model="catalogo.Nombre" />
                            <strong class="small text-danger">{{ errors["Nombre"] }}</strong>
                        </div>
                    </div>
                    <span class="badge badge-primary mt-3">Respuestas</span>
                    <hr style="margin-top: 5px;" />
                    <div class="row">
                        <div class="col-sm-12">
                            <label class="text-primary">Nombre de respuesta</label>
                        </div>
                        <div class="col-sm-12" ng-repeat="(index, CatalogoRespuesta) in catalogo.CatalogoRespuestas">
                            <div class="row">
                                <div class="col-sm-8" style="text-align: right;">
                                    <small>{{ CatalogoRespuesta.Nombre.length }} / 255</small>
                                </div>
                                <div class="col-sm-8">
                                    <input class="form-control" ng-model="CatalogoRespuesta.Nombre" />
                                </div>
                                <button class="btn btn-sm btn-danger mr-1" ng-click="Eliminar(index)" ng-if="catalogo.CatalogoRespuestas.length > 1">
                                    <i class="fa fa-minus"></i>
                                </button>
                                <button class="btn btn-sm btn-success" ng-click="Agregar()" ng-if="(index + 1) == catalogo.CatalogoRespuestas.length">
                                    <i class="fa fa-plus"></i>
                                </button>
                                <div class="col-sm-12">
                                    <strong class="small text-danger">{{ errors["CatalogoRespuestas[" + index + "].Nombre"] }}</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-footer">
                    <button class="btn btn-sm btn-success" ng-click="Guardar()">
                        <i class="fa fa-save"></i> Guardar
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
@section Scripts {
    <script>
        (function () {
            var app = angular.module('SedeshuApp', ['ui.bootstrap']);

            app.controller('createEditController',
                function ($scope, $http, $uibModal) {
                    $scope.catalogo = [];
                    $scope.errors = [];

                    $scope.init = function (model) {
                        $scope.catalogo = model;
                    };

                    $scope.Agregar = function () {
                        $scope.catalogo.CatalogoRespuestas.push({ Id: "", Nombre: "", CatalogoId: "" });
                    };

                    $scope.Eliminar = function (index) {
                        $scope.catalogo.CatalogoRespuestas.splice(index, 1);
                    };

                    $scope.cargarErrores = function (errors) {
                        $scope.errors = [];
                        for (var i = 0; i < errors.length; i++) {
                            $scope.errors[errors[i].Key] = errors[i].Error;
                        }
                    };

                    $scope.Guardar = function () {
                        $http.post('/CatalogoRespuestas/Guardar', $scope.catalogo)
                            .then(function (response) {
                                if (response.data === "ok") {
                                    window.location.href = baseUrl +"CatalogoRespuestas";
                                } else {
                                    $scope.cargarErrores(response.data);
                                }
                            });
                    };
                }
            );
        })();
    </script>
}